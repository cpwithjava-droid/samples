trigger:
- main

pool:
  name: selfhosted-172

variables:
  buildConfiguration: 'Release'
  outputFolder: '$(Build.ArtifactStagingDirectory)/publish'

steps:
# Install NuGet tool (optional, but recommended)
- task: NuGetToolInstaller@1

# Restore all NuGet packages for all solutions
- task: NuGetCommand@2
  inputs:
    restoreSolution: '**/*.sln'
    feedsToUse: 'select'

# Build all .NET projects in the repo
- script: |
    echo "Building all .NET projects in $(Build.SourcesDirectory)..."
    dotnet build **/*.sln --configuration $(buildConfiguration) --no-restore
  displayName: "Build .NET Samples"

# Run each sample project
- script: |
    echo "Running each sample project..."
    for proj in $(find . -name "*.csproj"); do
      echo "Running sample: $proj"
      dotnet run --project $proj --configuration $(buildConfiguration)
    done
  displayName: "Run .NET Samples"

# Optional: Publish artifacts (like build outputs)
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'dotnet-samples'
    publishLocation: 'Container'
